<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document Catalog</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="upload.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="navbar-container">
          <ul class="navbar-links">
            <li><a href="#" id="logout">Logout</a></li>

            <li class="dropdown" id="userDropdown">
              <button class="dropbtn" id="userDropdownBtn">
                Logged in as <span id="userName">Loading...</span>
              </button>
              <div class="dropdown-content" id="userDropdownContent">
                <p class="header"></p>
                <p><strong>Email:</strong> <span id="userEmail"></span></p>
                <p><strong>Role:</strong> <span id="userRole"></span></p>
                <p>
                  <strong>Pending Docs:</strong> <span id="pendingDocs"></span>
                </p>
                <p>
                  <strong>Quiz tokens</strong> <span id="userTokens"></span>
                </p>
              </div>
            </li>

            <li class="dropdown">
              <button class="dropbtn">
                Katalógus
                <i class="fa fa-caret-down"></i>
              </button>
              <div class="dropdown-content">
                <div class="row" id="category-container">
                  <!-- A kategóriák és alkategóriák ide fognak betöltődni -->
                </div>
              </div>
            </li>
            <li><a href="/trending/trending.html">Főoldal</a></li>
            <li><a href="/allquizzes/allquizzes.html">Kvízek</a></li>
            <li>
              <a href="/quizzes/quizzes.html" id="myquizresults"
                >Kvízeredményeim</a
              >
            </li>
            <li>
              <a href="/moderation/moderation.html" id="moderation"
                >Moderáció</a
              >
            </li>
            <li><a href="/static/login.html" id="navbar-login">Login</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <div id="upload-section" style="display: none">
      <h2>Fájl feltöltése a kategóriához</h2>
      <input type="file" id="file-input" />
      <input type="text" id="title-input" placeholder="Title" />
      <input type="text" id="description-input" placeholder="Description" />
      <button id="upload-button" disabled>Upload</button>
    </div>

    <div id="container" class="container">
      <div class="header-section">
        <h1>Upload Files</h1>
        <p>Tölts fel fájlokat a megadott kategóriához</p>
        <p>Kvízeknél támogatott formátumok: pdf, ppt, docx, txt</p>
      </div>
      <div class="drop-section">
        <div class="col">
          <div class="cloud-icon">
            <img src="icons/cloud.png" alt="cloud" />
          </div>
          <span>Drag & Drop your files here</span>
          <span>OR</span>
          <button class="file-selector">Browse Files</button>
          <input type="file" class="file-selector-input" multiple />
        </div>
        <div class="col">
          <div class="drop-here">Drop Here</div>
        </div>
      </div>

      <div class="list-section">
        <div class="up-section">
          <div class="col">
            <input type="text" class="file-name-input" placeholder="Name" />
            <label class="grouped-label">
              <input type="checkbox" class="grouped-checkbox" />
              Grouped Zip
            </label>
            <button class="upload-b">Upload</button>
          </div>
        </div>
        <div class="list-title">Files to upload</div>
        <div class="list"></div>
      </div>
    </div>

    <div id="loader-container" class="preloader" style="display: none">
      <div class="preloader__logo">
        <div class="preloader__circle"></div>
      </div>
    </div>

    <section id="documents">
      <h2 id="documents-category-title">Documents</h2>
      <div id="documents-list">
        <div class="document-card">
          <div class="document-title">Document Title</div>
          <div class="document-description">Document Description</div>
          <div class="document-actions">
            <button class="quiz-button">Kvíz</button>
            <button class="delete-button">Delete</button>
            <button class="edit-button">Edit</button>
          </div>
        </div>
      </div>
    </section>

    <script src="catalog.js"></script>
    <script src="upload.js"></script>
    <script src="alerts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <h2>Felhasználói adatok</h2>
    <button onclick="getUserData()">Felhasználói adatok lekérése</button>
    <p id="user_data" style="display: none"></p>
    <script>
      window.onload = async function () {
        const token = localStorage.getItem("token");
        if (!token) {
          if (!token) {
            document.getElementById("auth-link").style.display = "block";
            return;
          }
        }

        const response = await fetch("/me", {
          method: "GET",
          headers: { Authorization: "Bearer " + token },
        });
      };

      // Dinamikus kategória betöltés
      async function loadCategories() {
        const response = await fetch("/categories");
        const categories = await response.json();

        const categoryContainer = document.getElementById("category-container");
        categoryContainer.innerHTML = "";
        categories.forEach((category) => {
          const categoryColumn = document.createElement("div");
          categoryColumn.classList.add("column");

          const categoryTitle = document.createElement("h3");
          categoryTitle.textContent = category.name;
          categoryColumn.appendChild(categoryTitle);

          category.children.forEach((subcategory) => {
            const subcategoryLink = document.createElement("a");
            subcategoryLink.href = "#";
            subcategoryLink.textContent = subcategory.name;

            // Eseménykezelő hozzáadása, hogy betöltsük az adott kategóriához tartozó fájlokat
            subcategoryLink.onclick = async (e) => {
              const dropdownContent =
                document.querySelector(".dropdown-content");
              dropdownContent.style.display =
                dropdownContent.style.display === "none" ||
                dropdownContent.style.display === ""
                  ? "block"
                  : "none";
              e.preventDefault();

              window.location.href = `/catalog/catalog.html?selectedCategoryId=${subcategory.id}`;
              //await loadDocuments(subcategory.id); // Az alábbi kódban ezt a category_id-t használjuk
            };

            categoryColumn.appendChild(subcategoryLink);
          });

          categoryContainer.appendChild(categoryColumn);
        });
      }

      window.onload = loadCategories;
      //window.onload = loadDocuments2; // Kategóriák betöltése oldal betöltésekor

      // Dropdown gombra hover eseményfigyelő hozzáadásas
      document.querySelector(".dropbtn").addEventListener("mouseenter", () => {
        const dropdownContent = document.querySelector(".dropdown-content");
        dropdownContent.style.display = "block"; // Hoverkor megjelenítjük
      });

      document
        .querySelector(".dropdown-content")
        .addEventListener("mouseenter", () => {
          const dropdownContent = document.querySelector(".dropdown-content");
          dropdownContent.style.display = "block"; // Hoverkor megjelenítjük
        });
      document
        .querySelector(".dropdown-content")
        .addEventListener("mouseleave", () => {
          const dropdownContent = document.querySelector(".dropdown-content");
          dropdownContent.style.display = "none"; // Hoverkor megjelenítjük
        });

      // Dropdown gombra hoverről való eltávolítás (mouseleave)
      document.querySelector(".dropbtn").addEventListener("mouseleave", () => {
        const dropdownContent = document.querySelector(".dropdown-content");
        dropdownContent.style.display = "none"; // Hover elhagyásakor eltüntetjük
      });
    </script>
  </body>
</html>
