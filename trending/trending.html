<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document Catalog</title>
    <link rel="stylesheet" href="stylet.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="dropdown">
          <button class="dropbtn">
            Katalógus
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <div class="header">
              <h2>Fájlkategóriák</h2>
            </div>
            <div class="row" id="category-container">
              <!-- A kategóriák és alkategóriák ide fognak betöltődni -->
            </div>
          </div>
        </div>

        <div class="navbar-container">
          <ul class="navbar-links">
            <li>
              <a href="/moderation/moderation.html" id="moderation"
                >Moderáció</a
              >
            </li>
            <li><a href="#" id="logout">Logout</a></li>
            <li><a href="/static/login.html" id="navbar-login">Login</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <section id="documents">
      <h2 id="documents-category-title">Trending Documents</h2>
      <div id="documents-list"></div>
    </section>

    <section id="documents">
      <h2 id="documents-category-title">Recent Documents</h2>
      <div id="recent-list"></div>
    </section>

    <script src="trending.js"></script>

    <p id="user_data" style="display: none"></p>
    <script>
      window.onload = async function () {
        const token = localStorage.getItem("token");
        if (!token) {
          if (!token) {
            document.getElementById("auth-link").style.display = "block";
            return;
          }
        }

        const response = await fetch("http://127.0.0.1:8000/me", {
          method: "GET",
          headers: { Authorization: "Bearer " + token },
        });
      };

      async function getUserData() {
        const token = localStorage.getItem("token");
        if (!token) {
          //alert('Először jelentkezz be!');
          return;
        }

        const response = await fetch("http://127.0.0.1:8000/me", {
          method: "GET",
          headers: { Authorization: "Bearer " + token },
        });
        const data = await response.json();
        document.getElementById("user_data").innerText = JSON.stringify(
          data,
          null,
          2
        );
        return data;
      }

      // Dinamikus kategória betöltés
      async function loadCategories() {
        const response = await fetch("http://127.0.0.1:8000/categories");
        const categories = await response.json();

        const categoryContainer = document.getElementById("category-container");
        categoryContainer.innerHTML = "";
        categories.forEach((category) => {
          const categoryColumn = document.createElement("div");
          categoryColumn.classList.add("column");

          const categoryTitle = document.createElement("h3");
          categoryTitle.textContent = category.name;
          categoryColumn.appendChild(categoryTitle);

          category.children.forEach((subcategory) => {
            const subcategoryLink = document.createElement("a");
            subcategoryLink.href = "#";
            subcategoryLink.textContent = subcategory.name;

            // Eseménykezelő hozzáadása, hogy betöltsük az adott kategóriához tartozó fájlokat
            subcategoryLink.onclick = async (e) => {
              const dropdownContent =
                document.querySelector(".dropdown-content");
              dropdownContent.style.display =
                dropdownContent.style.display === "none" ||
                dropdownContent.style.display === ""
                  ? "block"
                  : "none";
              e.preventDefault();
              await loadDocuments(subcategory.id); // Az alábbi kódban ezt a category_id-t használjuk
            };

            categoryColumn.appendChild(subcategoryLink);
          });

          categoryContainer.appendChild(categoryColumn);
        });
      }

      window.onload = loadCategories; // Kategóriák betöltése oldal betöltésekor

      // Dropdown gombra hover eseményfigyelő hozzáadása
      document.querySelector(".dropbtn").addEventListener("mouseenter", () => {
        const dropdownContent = document.querySelector(".dropdown-content");
        dropdownContent.style.display = "block"; // Hoverkor megjelenítjük
      });

      document
        .querySelector(".dropdown-content")
        .addEventListener("mouseenter", () => {
          const dropdownContent = document.querySelector(".dropdown-content");
          dropdownContent.style.display = "block"; // Hoverkor megjelenítjük
        });
      document
        .querySelector(".dropdown-content")
        .addEventListener("mouseleave", () => {
          const dropdownContent = document.querySelector(".dropdown-content");
          dropdownContent.style.display = "none"; // Hoverkor megjelenítjük
        });

      // Dropdown gombra hoverről való eltávolítás (mouseleave)
      document.querySelector(".dropbtn").addEventListener("mouseleave", () => {
        const dropdownContent = document.querySelector(".dropdown-content");
        dropdownContent.style.display = "none"; // Hover elhagyásakor eltüntetjük
      });
    </script>
  </body>
</html>
